---
title: "開発現場でのSELinuxの位置づけとdisable"
---

# 開発現場でのSELinuxの位置づけとdisable

開発現場でSELinuxが「邪魔」「原因不明の403」になりがちな一方で、運用・セキュリティの観点では重要な
防御線の位置づけです。
しかし、ついついすぐ引っかかるから、disabledでやっちゃうことも多いです。

## Red Hat社の見解

Red Hat社は、SELinuxを「オプションのセキュリティ機能」ではなく、
**RHELの設計前提となる中核的なセキュリティ機構**として位置づけています。

公式ドキュメントでは一貫して、

- SELinuxは有効であることが前提
- 無効化（disabled）は推奨されない
- 問題がある場合は permissive を使って原因を調査する

という立場が明確に示されている。

特に「動かないからとりあえず切る」という対応については、
**問題解決ではなく回避であり、技術的には正しくない**という扱いとなります。
（しかし、どうしてもdisableしちゃうんですよねーーー）

Red Hatが想定している正しい運用フローは次の通り。

1. SELinuxを permissive にしてログを取得する
2. AVCログを確認し、どのアクセスが拒否されているかを把握する
3. boolean や context の調整で解決できないか検討する
4. 必要であれば最小限のカスタムポリシーを作成する
5. 最終的に enforcing に戻す

disabled にしてしまうと、ポリシー評価自体が行われなくなり、ログ（AVCログ）も出なくなるため、
**原因分析も学習もできなくなる**ってのがあります。

そのため Red Hat の公式見解としては、

> SELinux は切るものではなく、理解して調整するもの  
> 無効化は最終手段ですらなく、推奨されない

というスタンスになる。

開発環境であっても、「とりあえず disabled」は短期的には楽だが、
本番環境との乖離や技術的負債を生みやすいです。

少なくとも Red Hat の思想に沿うなら、**開発環境では permissive、本番では enforcing**
という運用が現実的かつ正攻法となります。

## どうするか

開発現場の現実として、SELinux を disabled にしたくなる気持ちは正直よく分かる。
時間がない、原因が分からない、とにかく動かしたい。そういう場面は確実に存在する。

ただし、少なくとも自分の手元や検証環境では、
**「とりあえず disabled」だけは選ばない**ようにしたいけどー。
結構SELinuxは学習コスト高くて足踏みしちゃいますね。

そこで、Red Hat の公式見解に沿うなら、まず選ぶべきは permissive となります。

permissive にすれば、

- アプリケーションは止まらない
- AVCログは残る
- 何が拒否されているかを後から確認できる

開発環境では permissive を基本とし、ログを見て「なぜ拒否されたのか」を理解したいです。
boolean や context の調整で解決できるならそれで良いし、必要なら最小限のポリシーを書く
というのが王道ですかねー。

そして最終的に、「この構成なら enforcing でも動く」という状態を目指す。

本番環境で enforcing にできない構成は、どこかに無理や歪みを抱えている可能性が高いと
考えるべくであろうと思います。

SELinux を切るかどうかは、単なる設定の話ではなく、**Linux をどう理解し、どう付き合うか**の姿勢の
問題とおもいます。

この研究室では、SELinux を「邪魔な存在」として避けるのではなく、**読み解く対象、理解すべき仕組み**として
研究したいです。

## 頼みの綱はやはりログですかね

結局のところ、SELinux と向き合う上で一番頼りになるのはログしかないかなーと思います。

設定ファイルやポリシーを眺めていても、「なぜ今このアクセスが拒否されたのか」は分からないですし。
それを教えてくれるのが AVC ログです。

SELinux は黙って拒否する仕組みではなく、**必ず理由をログとして残す**仕様になっています。
問題は、そのログの読み方に慣れていないのです。（めんどくさいからdisableしちゃうから慣れない）

AVC ログには、

- どのプロセス（source）が
- どのオブジェクト（target）に
- どんな操作（permission）をしようとして
- どのクラス（class）で拒否されたか

が、すべて書かれています。

最初は意味不明な type 名や属性に見えるが、「誰が」「何に」「何をしようとしたか」この関係だけ追うようにすると、
少しずつ見えてくるものがあります。
実際に自分でもなにも考えず、disableしてる自分がいます。

SELinux を disabled にしてしまうと、このログ（AVCログ）自体が出なくなる。
なので、**唯一の手がかりを自分で捨てている**状態になってしまうのです。

permissive でログを出し続けるというのは、「今は止めないが、後で必ず理解する」という気合と根性です。

SELinux は設定を当てずっぽうでいじるものではなく、ログを読んで、仮説を立てて、検証する対象だ。

だからこの研究室では、エラーそのものよりも、**そのときに出たログをどう読んだか**を大事にしていきたいと思う。

今現在は、私のサーバーは、disableにしているが。。。。
基本はやはりenforcing、少なくともpermissiveでログ保存は必要なのだと改めて思う。

## 一応それぞれのモードの切り替え方

SELinux には大きく分けて 3 つのモードがあります。

- enforcing
- permissive
- disabled

それぞれ役割と使いどころが違うので、切り替え方と合わせて整理しておく。

---

### 現在のモードを確認する

まずは今どうなっているかを確認する。

getenforce

または、

sestatus

`sestatus` の方が、現在のモードやポリシーの状態が少し詳しく分かる。

---

### enforcing ↔ permissive の切り替え（一時的）

動作を止めずにログを取りたい場合は、この切り替えを使う。

setenforce 0   # permissive  
setenforce 1   # enforcing  

この方法は **再起動すると元に戻る**。あくまで一時的な切り替えなので、検証やトラブルシュート向けです。

開発環境では、まず permissive にしてログを集める、という使い方が多い。

---

### 永続的にモードを変更する場合

再起動後もモードを維持したい場合は、設定ファイルを編集することになります。

vim /etc/selinux/config

中身はだいたいこんな感じ。

SELINUX=enforcing  
SELINUXTYPE=targeted  

`SELINUX=` の値を変更する。

- enforcing
- permissive
- disabled

変更後は **再起動が必要**となります。

---

### disabled についての注意点

SELINUX=disabled にすると、SELinux 自体が無効になる。

この状態では、

- ポリシー評価が行われない
- AVC ログも出ない
- トラブルの原因が追えなくなる

Red Hat の公式見解でも、disabled は推奨されていない。

「とりあえず動かす」には楽だが、**学習も原因分析もできなくなる**点は意識しておきたい。

---

### どれを使うかの整理

- 本番環境  
  → enforcing

- 開発・検証環境  
  → permissive を基本に、最終的に enforcing を目指す

- disabled  
  → 原則使わない（少なくとも常用しない）

SELinux のモード切り替えは、単なる設定変更ではなく、**どう向き合うかの姿勢そのもの**だと思っている。
